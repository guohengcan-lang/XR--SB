<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æé€Ÿæ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        /* åŸºç¡€é‡ç½®ä¸å¸ƒå±€ */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "å¾®è½¯é›…é»‘", sans-serif; }
        body { background: #f8f9fa; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .title { font-size: 22px; font-weight: bold; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .btn { padding: 6px 12px; border-radius: 4px; cursor: pointer; border: none; }
        .btn-primary { background: #165DFF; color: white; }
        .btn-danger { background: #F87272; color: white; }

        /* åˆ†ç±»æ ‡ç­¾ */
        .category-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .tag { padding: 4px 12px; background: #e9ecef; border-radius: 20px; cursor: pointer; }
        .tag.active { background: #165DFF; color: white; }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area { border: 2px dashed #ced4da; border-radius: 8px; padding: 30px; text-align: center; cursor: pointer; margin: 15px 0; }
        .upload-icon { font-size: 40px; color: #165DFF; margin-bottom: 10px; }
        .file-input { display: none; }

        /* æ–‡ä»¶åˆ—è¡¨ */
        .file-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .file-card { border: 1px solid #e9ecef; border-radius: 6px; padding: 10px; display: flex; flex-direction: column; }
        .file-name { font-weight: 500; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-meta { font-size: 12px; color: #6c757d; margin-bottom: 8px; }
        .file-actions { display: flex; gap: 6px; margin-top: auto; }
        .action-btn { font-size: 12px; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
        .download-btn { background: #e9ecef; color: #165DFF; }
        .delete-btn { background: #e9ecef; color: #F87272; }

        /* å¼¹çª— */
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background: white; padding: 24px; border-radius: 8px; width: 320px; }
        .modal-title { font-size: 18px; font-weight: bold; margin-bottom: 16px; }
        .modal-input { width: 100%; padding: 8px; margin-bottom: 16px; border: 1px solid #ced4da; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- åˆ†ç±»ç®¡ç†å¡ç‰‡ -->
        <div class="card">
            <div class="title">
                <span>æ–‡ä»¶åˆ†ç±»ç®¡ç†</span>
                <button class="btn btn-primary" id="createCatBtn">æ–°å»ºåˆ†ç±»</button>
            </div>
            <div class="category-tags" id="categoryTags">
                <div class="tag active" data-category="all">å…¨éƒ¨æ–‡ä»¶</div>
                <div class="tag" data-category="uncategorized">æœªåˆ†ç±»</div>
            </div>
        </div>

        <!-- ä¸Šä¼ æ–‡ä»¶å¡ç‰‡ -->
        <div class="card">
            <div class="title">ä¸Šä¼ æ–‡ä»¶</div>
            <label class="upload-area" for="fileUpload">
                <div class="upload-icon">ğŸ“¤</div>
                <p>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p >
                <p style="font-size: 12px; color: #6c757d;">æ”¯æŒå›¾ç‰‡ã€æ–‡æ¡£ç­‰æ ¼å¼ï¼Œå•æ–‡ä»¶â‰¤100MB</p >
                <input type="file" multiple class="file-input" id="fileUpload">
            </label>
        </div>

        <!-- æ–‡ä»¶åˆ—è¡¨å¡ç‰‡ -->
        <div class="card">
            <div class="title">
                <span id="fileListTitle">å…¨éƒ¨æ–‡ä»¶åˆ—è¡¨ (0ä¸ª)</span>
                <button class="btn btn-danger" id="batchDeleteBtn" disabled>æ‰¹é‡åˆ é™¤</button>
            </div>
            <div class="file-list" id="fileList">
                <div style="text-align: center; padding: 30px 0; color: #6c757d;">
                    <div style="font-size: 30px; margin-bottom: 10px;">ğŸ“‚</div>
                    <p>æš‚æ— æ–‡ä»¶ï¼Œè¯·ä¸Šä¼ æˆ–åˆ‡æ¢åˆ†ç±»</p >
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å»ºåˆ†ç±»å¼¹çª— -->
    <div class="modal" id="catModal">
        <div class="modal-content">
            <div class="modal-title">æ–°å»ºåˆ†ç±»</div>
            <input type="text" class="modal-input" id="catNameInput" placeholder="è¾“å…¥åˆ†ç±»åç§°ï¼ˆå¦‚ï¼šå·¥ä½œæ–‡æ¡£ï¼‰">
            <div style="display: flex; justify-content: flex-end; gap: 8px;">
                <button class="btn" onclick="document.getElementById('catModal').style.display = 'none'">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmCatBtn">ç¡®è®¤åˆ›å»º</button>
            </div>
        </div>
    </div>

    <script>
        // å­˜å‚¨æ•°æ®çš„æœ¬åœ°é”®å
        const STORAGE_KEY = "fastFileManager";
        // åˆå§‹åŒ–æ•°æ®ï¼ˆæ–‡ä»¶+åˆ†ç±»ï¼‰
        let data = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
        data.files = data.files || [];
        data.categories = data.categories || ["uncategorized"];

        // æ¸²æŸ“åˆ†ç±»æ ‡ç­¾
        function renderCategories() {
            const container = document.getElementById('categoryTags');
            container.innerHTML = '';
            // å…¨éƒ¨æ–‡ä»¶æ ‡ç­¾
            const allTag = document.createElement('div');
            allTag.className = "tag active";
            allTag.dataset.category = "all";
            allTag.textContent = "å…¨éƒ¨æ–‡ä»¶";
            container.appendChild(allTag);
            // å…¶ä»–åˆ†ç±»æ ‡ç­¾
            data.categories.forEach(cat => {
                const tag = document.createElement('div');
                tag.className = "tag";
                tag.dataset.category = cat;
                tag.textContent = cat === "uncategorized" ? "æœªåˆ†ç±»" : cat;
                container.appendChild(tag);
            });
            // ç»‘å®šæ ‡ç­¾ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
                    tag.classList.add('active');
                    renderFiles(tag.dataset.category);
                });
            });
        }

        // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
        function renderFiles(category) {
            const listEl = document.getElementById('fileList');
            const titleEl = document.getElementById('fileListTitle');
            const batchDeleteBtn = document.getElementById('batchDeleteBtn');
            let filteredFiles = data.files;
            
            // ç­›é€‰æ–‡ä»¶
            if (category !== "all") {
                filteredFiles = data.files.filter(file => file.category === category);
            }

            // æ›´æ–°æ ‡é¢˜
            titleEl.textContent = `${category === "all" ? "å…¨éƒ¨æ–‡ä»¶" : category}åˆ—è¡¨ (${filteredFiles.length}ä¸ª)`;

            // ç©ºçŠ¶æ€
            if (filteredFiles.length === 0) {
                listEl.innerHTML = `
                    <div style="text-align: center; padding: 30px 0; color: #6c757d;">
                        <div style="font-size: 30px; margin-bottom: 10px;">ğŸ“‚</div>
                        <p>æ­¤åˆ†ç±»ä¸‹æš‚æ— æ–‡ä»¶</p >
                    </div>
                `;
                batchDeleteBtn.disabled = true;
                return;
            }

            // æ¸²æŸ“æ–‡ä»¶å¡ç‰‡
            listEl.innerHTML = '';
            filteredFiles.forEach(file => {
                // ç¡®å®šæ–‡ä»¶å›¾æ ‡
                let icon = "ğŸ“„";
                if (file.type.startsWith('image/')) icon = "ğŸ–¼ï¸";
                else if (file.type.includes('pdf')) icon = "ğŸ“„";
                else if (file.type.includes('word')) icon = "ğŸ“";
                else if (file.type.includes('excel')) icon = "ğŸ“Š";

                const card = document.createElement('div');
                card.className = "file-card";
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span>${icon}</span>
                        <input type="checkbox" class="file-checkbox" data-file-id="${file.id}">
                    </div>
                    <div class="file-name" title="${file.name}">${file.name}</div>
                    <div class="file-meta">
                        <span>${file.size}</span>
                        <span style="margin: 0 4px;">â€¢</span>
                        <span>${file.category === "uncategorized" ? "æœªåˆ†ç±»" : file.category}</span>
                    </div>
                    <div class="file-actions">
                        <button class="action-btn download-btn" onclick="downloadFile('${file.id}')">ä¸‹è½½</button>
                        <button class="action-btn delete-btn" onclick="deleteFile('${file.id}')">åˆ é™¤</button>
                    </div>
                `;
                listEl.appendChild(card);
            });

            // æ‰¹é‡åˆ é™¤æŒ‰é’®çŠ¶æ€
            batchDeleteBtn.disabled = false;
        }

        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(fileId) {
            const file = data.files.find(f => f.id === fileId);
            if (!file) return;
            const a = document.createElement('a');
            a.href = file.content;
            a.download = file.name;
            a.click();
        }

        // åˆ é™¤å•ä¸ªæ–‡ä»¶
        function deleteFile(fileId) {
            if (confirm("ç¡®å®šåˆ é™¤æ­¤æ–‡ä»¶å—ï¼Ÿ")) {
                data.files = data.files.filter(f => f.id !== fileId);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                const activeCategory = document.querySelector('.tag.active').dataset.category;
                renderFiles(activeCategory);
            }
        }

        // æ‰¹é‡åˆ é™¤æ–‡ä»¶
        document.getElementById('batchDeleteBtn').addEventListener('click', () => {
            const checkedIds = Array.from(document.querySelectorAll('.file-checkbox:checked')).map(cb => cb.dataset.fileId);
            if (checkedIds.length === 0) return;
            if (confirm(`ç¡®å®šåˆ é™¤é€‰ä¸­çš„${checkedIds.length}ä¸ªæ–‡ä»¶å—ï¼Ÿ`)) {
                data.files = data.files.filter(f => !checkedIds.includes(f.id));
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                const activeCategory = document.querySelector('.tag.active').dataset.category;
                renderFiles(activeCategory);
            }
        });

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        document.getElementById('fileUpload').addEventListener('change', (e) => {
            const files = e.target.files;
            const activeCategory = document.querySelector('.tag.active').dataset.category;
            Array.from(files).forEach(file => {
                // é™åˆ¶æ–‡ä»¶å¤§å°ï¼ˆ100MBï¼‰
                if (file.size > 100 * 1024 * 1024) {
                    alert(`æ–‡ä»¶â€œ${file.name}â€è¶…è¿‡100MBï¼Œæ— æ³•ä¸Šä¼ `);
                    return;
                }

                // è¯»å–æ–‡ä»¶ä¸ºBase64
                const reader = new FileReader();
                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                    reader.onload = () => {
                        data.files.push({
                            id: "file_" + Date.now() + Math.random().toString(36).slice(2, 8),
                            name: file.name,
                            type: file.type,
                            size: formatFileSize(file.size),
                            category: activeCategory === "all" ? "uncategorized" : activeCategory,
                            content: reader.result
                        });
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                        renderFiles(activeCategory);
                    };
                } else {
                    reader.readAsArrayBuffer(file);
                    reader.onloadend = () => {
                        const base64 = btoa(String.fromCharCode(...new Uint8Array(reader.result)));
                        data.files.push({
                            id: "file_" + Date.now() + Math.random().toString(36).slice(2, 8),
                            name: file.name,
                            type: file.type || "application/octet-stream",
                            size: formatFileSize(file.size),
                            category: activeCategory === "all" ? "uncategorized" : activeCategory,
                            content: `data:${file.type || "application/octet-stream"};base64,${base64}`
                        });
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                        renderFiles(activeCategory);
                    };
                }
            });
            e.target.value = ''; // æ¸…ç©ºé€‰æ‹©æ¡†
        });

        // æ–°å»ºåˆ†ç±»é€»è¾‘
        document.getElementById('createCatBtn').addEventListener('click', () => {
            document.getElementById('catModal').style.display = "flex";
            document.getElementById('catNameInput').focus();
        });

        document.getElementById('confirmCatBtn').addEventListener('click', () => {
            const catName = document.getElementById('catNameInput').value.trim();
            if (!catName) return;
            if (data.categories.includes(catName)) {
                alert("åˆ†ç±»åç§°å·²å­˜åœ¨ï¼Œè¯·æ¢ä¸€ä¸ªï¼");
                return;
            }
            data.categories.push(catName);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            renderCategories();
            document.getElementById('catModal').style.display = "none";
            document.getElementById('catNameInput').value = '';
        });

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + " B";
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
            return (bytes / (1024 * 1024)).toFixed(1) + " MB";
        }

        // åˆå§‹åŒ–
        renderCategories();
        renderFiles("all");
    </script>
</body>
</html>