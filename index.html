<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>极速文件管理系统</title>
    <style>
        /* 基础重置与布局 */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "微软雅黑", sans-serif; }
        body { background: #f8f9fa; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .title { font-size: 22px; font-weight: bold; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .btn { padding: 6px 12px; border-radius: 4px; cursor: pointer; border: none; }
        .btn-primary { background: #165DFF; color: white; }
        .btn-danger { background: #F87272; color: white; }

        /* 分类标签 */
        .category-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .tag { padding: 4px 12px; background: #e9ecef; border-radius: 20px; cursor: pointer; }
        .tag.active { background: #165DFF; color: white; }

        /* 上传区域 */
        .upload-area { border: 2px dashed #ced4da; border-radius: 8px; padding: 30px; text-align: center; cursor: pointer; margin: 15px 0; }
        .upload-icon { font-size: 40px; color: #165DFF; margin-bottom: 10px; }
        .file-input { display: none; }

        /* 文件列表 */
        .file-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .file-card { border: 1px solid #e9ecef; border-radius: 6px; padding: 10px; display: flex; flex-direction: column; }
        .file-name { font-weight: 500; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-meta { font-size: 12px; color: #6c757d; margin-bottom: 8px; }
        .file-actions { display: flex; gap: 6px; margin-top: auto; }
        .action-btn { font-size: 12px; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
        .download-btn { background: #e9ecef; color: #165DFF; }
        .delete-btn { background: #e9ecef; color: #F87272; }

        /* 弹窗 */
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background: white; padding: 24px; border-radius: 8px; width: 320px; }
        .modal-title { font-size: 18px; font-weight: bold; margin-bottom: 16px; }
        .modal-input { width: 100%; padding: 8px; margin-bottom: 16px; border: 1px solid #ced4da; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- 分类管理卡片 -->
        <div class="card">
            <div class="title">
                <span>文件分类管理</span>
                <button class="btn btn-primary" id="createCatBtn">新建分类</button>
            </div>
            <div class="category-tags" id="categoryTags">
                <div class="tag active" data-category="all">全部文件</div>
                <div class="tag" data-category="uncategorized">未分类</div>
            </div>
        </div>

        <!-- 上传文件卡片 -->
        <div class="card">
            <div class="title">上传文件</div>
            <label class="upload-area" for="fileUpload">
                <div class="upload-icon">📤</div>
                <p>点击或拖拽文件到此处上传</p >
                <p style="font-size: 12px; color: #6c757d;">支持图片、文档等格式，单文件≤100MB</p >
                <input type="file" multiple class="file-input" id="fileUpload">
            </label>
        </div>

        <!-- 文件列表卡片 -->
        <div class="card">
            <div class="title">
                <span id="fileListTitle">全部文件列表 (0个)</span>
                <button class="btn btn-danger" id="batchDeleteBtn" disabled>批量删除</button>
            </div>
            <div class="file-list" id="fileList">
                <div style="text-align: center; padding: 30px 0; color: #6c757d;">
                    <div style="font-size: 30px; margin-bottom: 10px;">📂</div>
                    <p>暂无文件，请上传或切换分类</p >
                </div>
            </div>
        </div>
    </div>

    <!-- 新建分类弹窗 -->
    <div class="modal" id="catModal">
        <div class="modal-content">
            <div class="modal-title">新建分类</div>
            <input type="text" class="modal-input" id="catNameInput" placeholder="输入分类名称（如：工作文档）">
            <div style="display: flex; justify-content: flex-end; gap: 8px;">
                <button class="btn" onclick="document.getElementById('catModal').style.display = 'none'">取消</button>
                <button class="btn btn-primary" id="confirmCatBtn">确认创建</button>
            </div>
        </div>
    </div>

    <script>
        // 存储数据的本地键名
        const STORAGE_KEY = "fastFileManager";
        // 初始化数据（文件+分类）
        let data = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
        data.files = data.files || [];
        data.categories = data.categories || ["uncategorized"];

        // 渲染分类标签
        function renderCategories() {
            const container = document.getElementById('categoryTags');
            container.innerHTML = '';
            // 全部文件标签
            const allTag = document.createElement('div');
            allTag.className = "tag active";
            allTag.dataset.category = "all";
            allTag.textContent = "全部文件";
            container.appendChild(allTag);
            // 其他分类标签
            data.categories.forEach(cat => {
                const tag = document.createElement('div');
                tag.className = "tag";
                tag.dataset.category = cat;
                tag.textContent = cat === "uncategorized" ? "未分类" : cat;
                container.appendChild(tag);
            });
            // 绑定标签点击事件
            document.querySelectorAll('.tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
                    tag.classList.add('active');
                    renderFiles(tag.dataset.category);
                });
            });
        }

        // 渲染文件列表
        function renderFiles(category) {
            const listEl = document.getElementById('fileList');
            const titleEl = document.getElementById('fileListTitle');
            const batchDeleteBtn = document.getElementById('batchDeleteBtn');
            let filteredFiles = data.files;
            
            // 筛选文件
            if (category !== "all") {
                filteredFiles = data.files.filter(file => file.category === category);
            }

            // 更新标题
            titleEl.textContent = `${category === "all" ? "全部文件" : category}列表 (${filteredFiles.length}个)`;

            // 空状态
            if (filteredFiles.length === 0) {
                listEl.innerHTML = `
                    <div style="text-align: center; padding: 30px 0; color: #6c757d;">
                        <div style="font-size: 30px; margin-bottom: 10px;">📂</div>
                        <p>此分类下暂无文件</p >
                    </div>
                `;
                batchDeleteBtn.disabled = true;
                return;
            }

            // 渲染文件卡片
            listEl.innerHTML = '';
            filteredFiles.forEach(file => {
                // 确定文件图标
                let icon = "📄";
                if (file.type.startsWith('image/')) icon = "🖼️";
                else if (file.type.includes('pdf')) icon = "📄";
                else if (file.type.includes('word')) icon = "📝";
                else if (file.type.includes('excel')) icon = "📊";

                const card = document.createElement('div');
                card.className = "file-card";
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span>${icon}</span>
                        <input type="checkbox" class="file-checkbox" data-file-id="${file.id}">
                    </div>
                    <div class="file-name" title="${file.name}">${file.name}</div>
                    <div class="file-meta">
                        <span>${file.size}</span>
                        <span style="margin: 0 4px;">•</span>
                        <span>${file.category === "uncategorized" ? "未分类" : file.category}</span>
                    </div>
                    <div class="file-actions">
                        <button class="action-btn download-btn" onclick="downloadFile('${file.id}')">下载</button>
                        <button class="action-btn delete-btn" onclick="deleteFile('${file.id}')">删除</button>
                    </div>
                `;
                listEl.appendChild(card);
            });

            // 批量删除按钮状态
            batchDeleteBtn.disabled = false;
        }

        // 下载文件
        function downloadFile(fileId) {
            const file = data.files.find(f => f.id === fileId);
            if (!file) return;
            const a = document.createElement('a');
            a.href = file.content;
            a.download = file.name;
            a.click();
        }

        // 删除单个文件
        function deleteFile(fileId) {
            if (confirm("确定删除此文件吗？")) {
                data.files = data.files.filter(f => f.id !== fileId);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                const activeCategory = document.querySelector('.tag.active').dataset.category;
                renderFiles(activeCategory);
            }
        }

        // 批量删除文件
        document.getElementById('batchDeleteBtn').addEventListener('click', () => {
            const checkedIds = Array.from(document.querySelectorAll('.file-checkbox:checked')).map(cb => cb.dataset.fileId);
            if (checkedIds.length === 0) return;
            if (confirm(`确定删除选中的${checkedIds.length}个文件吗？`)) {
                data.files = data.files.filter(f => !checkedIds.includes(f.id));
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                const activeCategory = document.querySelector('.tag.active').dataset.category;
                renderFiles(activeCategory);
            }
        });

        // 处理文件上传
        document.getElementById('fileUpload').addEventListener('change', (e) => {
            const files = e.target.files;
            const activeCategory = document.querySelector('.tag.active').dataset.category;
            Array.from(files).forEach(file => {
                // 限制文件大小（100MB）
                if (file.size > 100 * 1024 * 1024) {
                    alert(`文件“${file.name}”超过100MB，无法上传`);
                    return;
                }

                // 读取文件为Base64
                const reader = new FileReader();
                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                    reader.onload = () => {
                        data.files.push({
                            id: "file_" + Date.now() + Math.random().toString(36).slice(2, 8),
                            name: file.name,
                            type: file.type,
                            size: formatFileSize(file.size),
                            category: activeCategory === "all" ? "uncategorized" : activeCategory,
                            content: reader.result
                        });
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                        renderFiles(activeCategory);
                    };
                } else {
                    reader.readAsArrayBuffer(file);
                    reader.onloadend = () => {
                        const base64 = btoa(String.fromCharCode(...new Uint8Array(reader.result)));
                        data.files.push({
                            id: "file_" + Date.now() + Math.random().toString(36).slice(2, 8),
                            name: file.name,
                            type: file.type || "application/octet-stream",
                            size: formatFileSize(file.size),
                            category: activeCategory === "all" ? "uncategorized" : activeCategory,
                            content: `data:${file.type || "application/octet-stream"};base64,${base64}`
                        });
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                        renderFiles(activeCategory);
                    };
                }
            });
            e.target.value = ''; // 清空选择框
        });

        // 新建分类逻辑
        document.getElementById('createCatBtn').addEventListener('click', () => {
            document.getElementById('catModal').style.display = "flex";
            document.getElementById('catNameInput').focus();
        });

        document.getElementById('confirmCatBtn').addEventListener('click', () => {
            const catName = document.getElementById('catNameInput').value.trim();
            if (!catName) return;
            if (data.categories.includes(catName)) {
                alert("分类名称已存在，请换一个！");
                return;
            }
            data.categories.push(catName);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            renderCategories();
            document.getElementById('catModal').style.display = "none";
            document.getElementById('catNameInput').value = '';
        });

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + " B";
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
            return (bytes / (1024 * 1024)).toFixed(1) + " MB";
        }

        // 初始化
        renderCategories();
        renderFiles("all");
    </script>
</body>
</html>